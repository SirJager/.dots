# =====================================================
# General Settings
# =====================================================

# Auto create new session if no other exists
# new-session -n $EDITOR

# Use Vi mode
setw -g mode-keys vi

# Increase scrollback buffer size
set -g history-limit 10000

# Start window and pane numbering from 1 for easier switching
set -g base-index 1
setw -g pane-base-index 1

# Allow automatic renaming of windows
set -g allow-rename on
# set -g automatic-rename off

# Renumber windows when one is removed.
set -g renumber-windows on

# Improve colors
set -g default-terminal "${TERM}"

# Enable undercurl
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'

# Enable undercurl colors
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'  # underscore colours - needs tmux-3.0

# Allow the mouse to resize windows and select tabs
set -g mouse on

# Allow tmux to set the terminal title
set -g set-titles on

# Monitor window activity to display in the status bar
setw -g monitor-activity on

# A bell in another window should cause a bell in the current window
set -g bell-action any

# Don't show distracting notifications
set -g visual-bell off
set -g visual-activity off

# Focus events enabled for terminals that support them
set -g focus-events on

# Useful when using sharing a session with different size terminals
setw -g aggressive-resize on

# don't detach tmux when killing a session
set -g detach-on-destroy off

# address vim mode switching delay (http://superuser.com/a/252717/65504)
set -s escape-time 0

set -as terminal-features ",*:RGB"
# set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# Auto create new session if no other exists
new-session -n $EDITOR

# =====================================================
# Keybindigns
# =====================================================

# set prefix
unbind C-b
set -g prefix M-q
bind-key M-q send-prefix

# start windows and panes from 1, not 0
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1

# Press prefix + r to reload tmux configs
unbind r
bind r source-file ~/.config/tmux/tmux.conf \; display "Reloaded Tmux Configs"

# Switch between two most recently used windows: Prefix; Space
bind Space last-window

# Switch between two most recently used sessions: Prefix; b
bind b switch-client -l

# Set Vim Mode
set-window-option -g mode-keys vi
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toogle
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# Switch windows
bind -n M-h previous-window
bind -n M-l next-window

# spilt pane in current dir
bind '\' split-window -h -c "#{pane_current_path}"
bind '-' split-window -v -c "#{pane_current_path}"

# Kill pane: Prefix; Shift + w
bind -r W kill-pane

# Resize panes: Prefix; h/j/k/l
bind -r j resize-pane -D 5
bind -r k resize-pane -U 5
bind -r l resize-pane -R 5
bind -r h resize-pane -L 5

# Maximize current pane: Prefix; m
bind -r m resize-pane -Z 

bind-key n new-window -c

# LazyGit NewWindow: Prefix; g
bind-key g new-window -n lazygit -c "#{pane_current_path}" "lazygit"

# Open application: Prefix; o
bind-key o command-prompt -p "open app: " "new-window '%%'"

# Copy to sytem clipboard: Prefix; y
bind-key y run -b "tmux show-buffer | xclip -selection clipboard"\; display-message "copied tmux buffer to system clipboard"

# Move tmux status bar to top: Prefix; ctrl+k
bind-key C-k run-shell "tmux set-option -g status-position top;"

# Move tmux status bar to bottom: Prefix; ctrl+j
bind-key C-j run-shell "tmux set-option -g status-position bottom;"

# Jump between sessions: Prefix; ctrl+e
bind C-e display-popup -E "\
    tmux list-sessions -F '#{?session_attached,,#{session_name}}' |\
    sed '/^$/d' |\
    fzf --reverse --header jump-to-session |\
    xargs tmux switch-client -t"


# =====================================================
# Appearance 
# =====================================================
set -g status-position bottom

# dracula theme configs
set -g @dracula-show-powerline false
set -g @dracula-plugins "git time battery"
set -g @dracula-git-disable-status false
set -g @dracula-git-no-untracked-files true
set -g @dracula-git-show-remote-status true
set -g @dracula-git-no-repo-message "" #  
set -g @dracula-show-timezone false
set -g @dracula-day-month true
set -g @dracula-military-time true
set -g @dracula-show-left-icon ""  #                      
set -g @dracula-time-format "%a %d %h %H:%M"



# =====================================================
# Plugins settings
# =====================================================
set-environment -g TMUX_PLUGIN_MANAGER_PATH "$HOME/.local/share/tmux"

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'christoomey/vim-tmux-navigator'
# set -g @plugin 'tmux-plugins/tmux-resurrect'
# set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'dracula/tmux'
# set -g @plugin 'egel/tmux-gruvbox'
# set -g @tmux-gruvbox 'dark' # dark or light

# set -g @resurrect-capture-pane-contents 'on'
# set -g @continuum-restore 'on'

# Initialize plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.local/share/tmux/plugins/tpm/tpm'

